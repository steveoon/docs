---
title: "工具调用"
description: "让 AI 调用外部工具完成复杂任务"
---

## 什么是工具调用？

工具调用允许 AI 模型执行外部功能，如运行代码、查询数据库、生成特定格式的内容等。

## 基础用法

通过 `allowedTools` 数组启用工具：

```json
{
  "model": "anthropic/claude-3-7-sonnet-20250219",
  "messages": [
    {
      "role": "user",
      "content": "帮我列出当前目录的文件"
    }
  ],
  "allowedTools": ["bash"]
}
```

## 工具示例

### Bash 工具

执行 Bash 命令：

```javascript
const response = await fetch("https://huajune.duliday.com/api/v1/chat", {
  method: "POST",
  headers: {
    Authorization: `Bearer ${apiKey}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    model: "anthropic/claude-3-7-sonnet-20250219",
    messages: [{ role: "user", content: "检查系统磁盘使用情况" }],
    allowedTools: ["bash"],
    stream: true,
  }),
});
```

### zhipin_reply_generator 工具

生成 BOSS 直聘招聘回复：

```json
{
  "model": "anthropic/claude-3-7-sonnet-20250219",
  "messages": [
    {
      "role": "user",
      "content": "候选人问：你们工资多少？"
    }
  ],
  "allowedTools": ["zhipin_reply_generator"],
  "context": {
    "preferredBrand": "蜀地源冒菜",
    "configData": {
      "city": "上海",
      "brands": {
        "蜀地源冒菜": {
          "templates": {
            "salary_inquiry": ["基本工资4000-6000元，另有全勤奖、绩效奖等"]
          }
        }
      }
    },
    "replyPrompts": {
      "salary_inquiry": "用礼貌的语气说明薪资待遇，避免承诺无法兑现的条件"
    }
  }
}
```

## 工具上下文

某些工具需要额外的上下文信息。使用 `context` 和 `toolContext` 提供：

```json
{
  "allowedTools": ["zhipin_reply_generator"],
  "context": {
    "configData": { ... },
    "replyPrompts": { ... }
  },
  "toolContext": {
    "zhipin_reply_generator": {
      "replyPrompts": {
        "general_chat": "自定义回复模板"
      }
    }
  }
}
```

## 上下文策略

控制缺失上下文时的行为：

### error 策略（默认）

缺少必需上下文时返回错误：

```json
{
  "error": "BadRequest",
  "message": "Missing required context: configData, replyPrompts",
  "statusCode": 400
}
```

### skip 策略

跳过无法初始化的工具：

```json
{
  "allowedTools": ["bash", "zhipin_reply_generator"],
  "contextStrategy": "skip"
}
```

响应头包含被跳过的工具：

```
X-Tools-Skipped: zhipin_reply_generator
```

### report 策略

仅返回验证报告：

```json
{
  "contextStrategy": "report"
}
```

或使用 `validateOnly`：

```json
{
  "validateOnly": true
}
```

## 工具响应格式

流式输出中的工具调用事件：

```
event: tool
data: {"type":"tool.start","name":"bash","args":{"command":"ls -la"}}

event: tool
data: {"type":"tool.output","name":"bash","output":"文件列表..."}
```

## 完整示例

<CodeGroup>

```javascript JavaScript
const response = await fetch("https://huajune.duliday.com/api/v1/chat", {
  method: "POST",
  headers: {
    Authorization: `Bearer ${apiKey}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    model: "anthropic/claude-3-7-sonnet-20250219",
    messages: [{ role: "user", content: "帮我创建一个test.txt文件" }],
    allowedTools: ["bash"],
    stream: true,
  }),
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const chunk = decoder.decode(value);
  const lines = chunk.split("\n");

  for (const line of lines) {
    if (line.startsWith("event: tool")) {
      console.log("工具调用:", line);
    }
  }
}
```

```python Python
import requests

url = "https://huajune.duliday.com/api/v1/chat"
headers = {
    "Authorization": f"Bearer {api_key}",
    "Content-Type": "application/json"
}
payload = {
    "model": "anthropic/claude-3-7-sonnet-20250219",
    "messages": [
        {"role": "user", "content": "帮我创建一个test.txt文件"}
    ],
    "allowedTools": ["bash"],
    "stream": True
}

with requests.post(url, json=payload, headers=headers, stream=True) as response:
    for line in response.iter_lines():
        if line:
            decoded = line.decode('utf-8')
            if 'tool' in decoded:
                print(f"工具调用: {decoded}")
```

</CodeGroup>

## 下一步

<CardGroup cols={2}>
  <Card
    title="工具系统"
    icon="book"
    href="/concepts/tools"
  >
    深入了解工具系统
  </Card>

  <Card
    title="上下文管理"
    icon="gear"
    href="/concepts/context"
  >
    理解工具上下文配置
  </Card>
</CardGroup>
