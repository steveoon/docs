---
title: "é”™è¯¯ç è¡¨"
description: "API é”™è¯¯ç å®Œæ•´å‚è€ƒ"
---

## HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | é”™è¯¯ç±»å‹            | è¯´æ˜                                 |
| ------ | ------------------- | ------------------------------------ |
| 200    | -                   | è¯·æ±‚æˆåŠŸ                             |
| 400    | BadRequest          | è¯·æ±‚å‚æ•°é”™è¯¯                         |
| 401    | Unauthorized        | è®¤è¯å¤±è´¥                             |
| 403    | Forbidden           | æƒé™ä¸è¶³                             |
| 404    | NotFound            | èµ„æºä¸å­˜åœ¨                           |
| 409    | Conflict            | èµ„æºå†²çª                             |
| 429    | TooManyRequests     | è¶…è¿‡é€Ÿç‡é™åˆ¶ï¼ˆâš ï¸ å½“å‰æœªå®ç°ï¼‰        |
| 500    | InternalServerError | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯                       |
| 503    | ServiceUnavailable  | æœåŠ¡æš‚æ—¶ä¸å¯ç”¨                       |

## é”™è¯¯å“åº”æ ¼å¼

æ‰€æœ‰é”™è¯¯å“åº”éµå¾ªç»Ÿä¸€æ ¼å¼:

```json
{
  "error": "ErrorType",
  "message": "Human-readable error message",
  "details": {
    "key": "additional info"
  },
  "statusCode": 400,
  "correlationId": "req_abc123"
}
```

## è¯¦ç»†é”™è¯¯è¯´æ˜

### 400 Bad Request

#### ç¼ºå°‘å¿…éœ€å‚æ•°

```json
{
  "error": "BadRequest",
  "message": "Missing required field: model",
  "statusCode": 400,
  "correlationId": "req_abc123"
}
```

**åŸå› **: è¯·æ±‚ä½“ç¼ºå°‘å¿…éœ€çš„ `model` å­—æ®µ

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿è¯·æ±‚åŒ…å«æ‰€æœ‰å¿…éœ€å‚æ•°

#### æ— æ•ˆçš„æ¨¡å‹ ID

```json
{
  "error": "BadRequest",
  "message": "Invalid model format. Expected 'provider/model'",
  "statusCode": 400,
  "correlationId": "req_def456"
}
```

**åŸå› **: æ¨¡å‹ ID æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼,å¦‚ `anthropic/claude-3-7-sonnet-20250219`

#### ç¼ºå°‘å·¥å…·ä¸Šä¸‹æ–‡

```json
{
  "error": "BadRequest",
  "message": "Missing required context for tool: zhipin_reply_generator",
  "details": {
    "missingContext": ["configData", "replyPrompts"],
    "tools": ["zhipin_reply_generator"]
  },
  "statusCode": 400,
  "correlationId": "req_ghi789"
}
```

**åŸå› **: å·¥å…·ç¼ºå°‘å¿…éœ€çš„ä¸Šä¸‹æ–‡å‚æ•°

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ `context` æˆ– `toolContext` ä¸­æä¾›ç¼ºå¤±å­—æ®µ
2. ä½¿ç”¨ `contextStrategy: "skip"` è·³è¿‡è¯¥å·¥å…·
3. ä½¿ç”¨ `GET /api/v1/tools` æŸ¥çœ‹å·¥å…·çš„ `requiredContext`

#### æ¶ˆæ¯æ ¼å¼é”™è¯¯

```json
{
  "error": "BadRequest",
  "message": "Invalid message format. Messages must be an array",
  "statusCode": 400,
  "correlationId": "req_jkl012"
}
```

**åŸå› **: `messages` å­—æ®µä¸æ˜¯æ•°ç»„æ ¼å¼

**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ `messages` æ˜¯ä¸€ä¸ªæ•°ç»„,åŒ…å« role å’Œ content å­—æ®µ

### 401 Unauthorized

#### API Key æ— æ•ˆæˆ–ç¼ºå¤±

```json
{
  "error": "Unauthorized",
  "message": "Invalid or missing API key",
  "statusCode": 401
}
```

<Warning>
  **æ³¨æ„**ï¼š401 è®¤è¯é”™è¯¯åœ¨ middleware å±‚å¤„ç†,å“åº”ä¸­**ä¸åŒ…å«** `correlationId` å­—æ®µ,å“åº”å¤´ä¸­ä¹Ÿ**ä¸åŒ…å«** `X-Correlation-Id`ã€‚åªæœ‰è¿›å…¥ API è·¯ç”±åçš„é”™è¯¯ï¼ˆ400ã€403ã€500 ç­‰ï¼‰æ‰åŒ…å« correlationIdã€‚
</Warning>

**åŸå› **: API Key æ— æ•ˆã€è¿‡æœŸæˆ–æœªæä¾›

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ Authorization å¤´æ ¼å¼: `Bearer YOUR_API_KEY`
3. éªŒè¯ API Key æ˜¯å¦å·²è¿‡æœŸ
4. è”ç³»ç®¡ç†å‘˜é‡æ–°ç”Ÿæˆ API Key

#### è®¤è¯å¤´æ ¼å¼é”™è¯¯

```json
{
  "error": "Unauthorized",
  "message": "Invalid authorization header format",
  "statusCode": 401
}
```

**åŸå› **: Authorization å¤´æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ­£ç¡®æ ¼å¼ `Authorization: Bearer YOUR_API_KEY`

### 403 Forbidden

#### æ¨¡å‹ä¸å¯ç”¨

```json
{
  "error": "Forbidden",
  "message": "Model not available with your API key",
  "statusCode": 403,
  "correlationId": "req_stu901"
}
```

**åŸå› **: è¯·æ±‚çš„æ¨¡å‹ä¸åœ¨ä½ çš„è®¸å¯åˆ—è¡¨ä¸­

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ `GET /api/v1/models` æŸ¥çœ‹å¯ç”¨æ¨¡å‹
2. è”ç³»ç®¡ç†å‘˜å‡çº§æƒé™
3. ä½¿ç”¨è®¸å¯åˆ—è¡¨ä¸­çš„å…¶ä»–æ¨¡å‹

#### å·¥å…·ä¸å¯ç”¨

```json
{
  "error": "Forbidden",
  "message": "Tool 'custom_tool' not available with your API key",
  "statusCode": 403,
  "correlationId": "req_vwx234"
}
```

**åŸå› **: è¯·æ±‚çš„å·¥å…·ä¸åœ¨ä½ çš„è®¸å¯åˆ—è¡¨ä¸­

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ `GET /api/v1/tools` æŸ¥çœ‹å¯ç”¨å·¥å…·
2. è”ç³»ç®¡ç†å‘˜å¯ç”¨è¯¥å·¥å…·
3. ä» `allowedTools` ä¸­ç§»é™¤ä¸å¯ç”¨çš„å·¥å…·

### 404 Not Found

```json
{
  "error": "NotFound",
  "message": "Endpoint not found",
  "statusCode": 404,
  "correlationId": "req_yzab567"
}
```

**åŸå› **: è¯·æ±‚çš„ç«¯ç‚¹ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ URL æ‹¼å†™æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„ HTTP æ–¹æ³•
3. å‚è€ƒ [API æ¦‚è§ˆ](/api-reference/introduction) æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ç«¯ç‚¹

### 409 Conflict

```json
{
  "error": "Conflict",
  "message": "A conversation with this ID already exists",
  "statusCode": 409,
  "correlationId": "req_cdef890"
}
```

**åŸå› **: èµ„æºå†²çª,å¦‚é‡å¤çš„ä¼šè¯ ID

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ä¸åŒçš„æ ‡è¯†ç¬¦æˆ–æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨

### 429 TooManyRequestsï¼ˆå½“å‰æœªå®ç°ï¼‰

<Warning>
  **å®ç°çŠ¶æ€**ï¼š
  - âŒ å½“å‰ API **æœªå®ç°**é€Ÿç‡é™åˆ¶åŠŸèƒ½
  - âŒ ä¸ä¼šè¿”å› 429 é”™è¯¯å“åº”
  - âŒ ä¸ä¼šè®¾ç½® `Retry-After` å“åº”å¤´
  - âœ… é”™è¯¯ç±»å‹å·²å®šä¹‰ï¼ˆ`TooManyRequests`ï¼‰ï¼Œä½†æœªåœ¨ä»£ç ä¸­ä½¿ç”¨
  - ğŸ’¡ å¦‚éœ€é™æµ,å»ºè®®åœ¨**ç½‘å…³å±‚æˆ– middleware** å®ç°
</Warning>

**ç†è®ºå“åº”æ ¼å¼**ï¼ˆå¦‚æœå®ç°ï¼‰ï¼š

```json
{
  "error": "TooManyRequests",
  "message": "Rate limit exceeded",
  "statusCode": 429,
  "correlationId": "req_ghij123"
}
```

**å¦‚æœå®ç°,å»ºè®®çš„å“åº”å¤´**ï¼š
```http
Retry-After: 10
```

<Note>
  **è®¾è®¡è¯´æ˜**ï¼šå¦‚æœæœªæ¥å®ç°é™æµåŠŸèƒ½,å»ºè®®é€šè¿‡ HTTP å“åº”å¤´ `Retry-After`ï¼ˆå•ä½ï¼šç§’ï¼‰ä¼ é€’é‡è¯•ç­‰å¾…æ—¶é—´ã€‚
</Note>

**å¦‚æœå®ç°,å»ºè®®çš„å®¢æˆ·ç«¯å¤„ç†ç­–ç•¥**ï¼š
1. å®ç°æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥
2. è¯»å–å“åº”å¤´ `Retry-After` è·å–å»ºè®®çš„é‡è¯•æ—¶é—´
3. å‡å°‘å¹¶å‘è¯·æ±‚æ•°
4. è”ç³»é”€å”®å›¢é˜Ÿæå‡é™é¢

### 500 Internal Server Error

```json
{
  "error": "InternalServerError",
  "message": "An unexpected error occurred",
  "statusCode": 500,
  "correlationId": "req_klmn456"
}
```

**åŸå› **: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ `correlationId` è”ç³»æŠ€æœ¯æ”¯æŒ
2. ç¨åé‡è¯•è¯·æ±‚
3. æ£€æŸ¥æœåŠ¡çŠ¶æ€é¡µé¢

### 503 Service Unavailable

```json
{
  "error": "ServiceUnavailable",
  "message": "Service temporarily unavailable. Please try again later.",
  "statusCode": 503,
  "correlationId": "req_opqr789"
}
```

**åŸå› **: æœåŠ¡æš‚æ—¶ä¸å¯ç”¨(ç»´æŠ¤ã€è¿‡è½½ç­‰)

**è§£å†³æ–¹æ¡ˆ**:
1. ç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•
2. å®ç°é‡è¯•æœºåˆ¶
3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€é¡µé¢

## ç‰¹æ®Šé”™è¯¯åœºæ™¯

### ä¸Šä¸‹æ–‡ç­–ç•¥é”™è¯¯

ä½¿ç”¨ `contextStrategy: "error"` æ—¶,ç¼ºå°‘ä¸Šä¸‹æ–‡ä¼šè¿”å›:

```json
{
  "error": "BadRequest",
  "message": "Missing required context: configData",
  "details": {
    "missingContext": ["configData"],
    "tools": ["zhipin_reply_generator"],
    "strategy": "error"
  },
  "statusCode": 400,
  "correlationId": "req_stuv012"
}
```

### éªŒè¯æ¨¡å¼æŠ¥å‘Š

ä½¿ç”¨ `validateOnly: true` æˆ– `contextStrategy: "report"` æ—¶è¿”å›éªŒè¯æŠ¥å‘Šï¼ˆä¸åŒ…è£…åœ¨ success/data ä¸­ï¼‰ï¼š

```json
{
  "valid": false,
  "model": {
    "valid": true
  },
  "tools": [
    {
      "name": "zhipin_reply_generator",
      "valid": false,
      "missingContext": ["configData", "replyPrompts"]
    }
  ]
}
```

<Note>
  **éªŒè¯æŠ¥å‘Šè¯´æ˜**ï¼š
  - ç›´æ¥è¿”å› ValidationReport å¯¹è±¡,ä¸åŒ…è£…åœ¨ `{success, data}` ä¸­
  - `valid`: æ€»ä½“éªŒè¯æ˜¯å¦é€šè¿‡
  - `model`: æ¨¡å‹éªŒè¯ç»“æœ
  - `tools`: æ¯ä¸ªå·¥å…·çš„éªŒè¯ç»“æœæ•°ç»„
</Note>

### æµå¼è¾“å‡ºä¸­çš„é”™è¯¯

æµå¼å“åº”é‡åˆ°é”™è¯¯æ—¶ä¼šä¸­æ–­è¿æ¥ã€‚å¦‚æœé”™è¯¯å‘ç”Ÿåœ¨æµå¼€å§‹å,å®¢æˆ·ç«¯å¯èƒ½ä¼šæ”¶åˆ°éƒ¨åˆ†æ•°æ®åæ–­å¼€è¿æ¥ã€‚

<Note>
  **æµå¼é”™è¯¯å¤„ç†**ï¼š
  - æµå¼è¾“å‡ºä¸ä¼šè¿”å›ç‰¹æ®Šçš„é”™è¯¯äº‹ä»¶ç±»å‹
  - å¦‚æœéªŒè¯å¤±è´¥,ä¸ä¼šå¼€å§‹æµå¼å“åº”,ç›´æ¥è¿”å› HTTP é”™è¯¯ï¼ˆ400, 401ç­‰ï¼‰
  - å¦‚æœæµå¼è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯,è¿æ¥ä¼šä¸­æ–­,å®¢æˆ·ç«¯éœ€è¦å®ç°é”™è¯¯æ¢å¤æœºåˆ¶
  - å»ºè®®åœ¨æµå¼è¯·æ±‚ä¸­å®ç°è¶…æ—¶å’Œé‡è¯•é€»è¾‘
</Note>

## é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

<AccordionGroup>
  <Accordion title="è®°å½• correlationId">
    æ¯ä¸ªé”™è¯¯å“åº”éƒ½åŒ…å« `correlationId`,ä¾¿äºé—®é¢˜æ’æŸ¥:

    ```javascript
    try {
      const response = await fetch(url, options);
      const data = await response.json();

      if (!response.ok) {
        console.error(`Error [${data.correlationId}]:`, data.message);
        // è®°å½•åˆ°æ—¥å¿—ç³»ç»Ÿ
      }
    } catch (error) {
      console.error('Request failed:', error);
    }
    ```
  </Accordion>

  <Accordion title="å®ç°é‡è¯•æœºåˆ¶">
    å¯¹äº 5xx é”™è¯¯å®ç°é‡è¯•ï¼ˆ429 å½“å‰æœªå®ç°,ä»£ç ä¸ºæœªæ¥å…¼å®¹æ€§ä¿ç•™ï¼‰ï¼š

    ```javascript
    async function fetchWithRetry(url, options, maxRetries = 3) {
      for (let i = 0; i < maxRetries; i++) {
        try {
          const response = await fetch(url, options);

          // 429 å¤„ç†ï¼ˆå½“å‰ä¸ä¼šè§¦å‘,ä¸ºæœªæ¥å…¼å®¹æ€§ä¿ç•™ï¼‰
          if (response.status === 429) {
            const retryAfter = parseInt(response.headers.get('Retry-After') || '5');
            await sleep(retryAfter * 1000);
            continue;
          }

          if (response.status >= 500) {
            if (i === maxRetries - 1) throw new Error('Server error');
            await sleep(Math.pow(2, i) * 1000); // æŒ‡æ•°é€€é¿
            continue;
          }

          return response;
        } catch (error) {
          if (i === maxRetries - 1) throw error;
        }
      }
    }
    ```

    <Note>
      **æ³¨æ„**ï¼šå½“å‰ API ä¸ä¼šè¿”å› 429 é”™è¯¯ï¼ˆæœªå®ç°é™æµï¼‰ï¼Œ429 å¤„ç†é€»è¾‘ä¸ºæœªæ¥å…¼å®¹æ€§ä¿ç•™ã€‚
    </Note>
  </Accordion>

  <Accordion title="åŒºåˆ†é”™è¯¯ç±»å‹">
    æ ¹æ®çŠ¶æ€ç é‡‡å–ä¸åŒçš„å¤„ç†ç­–ç•¥:

    ```javascript
    function handleError(error) {
      switch (error.statusCode) {
        case 401:
          redirectToLogin(); // é‡æ–°è®¤è¯
          break;
        case 403:
          showPermissionError(); // æƒé™æç¤º
          break;
        case 429:
          // å½“å‰ä¸ä¼šè§¦å‘,ä¸ºæœªæ¥å…¼å®¹æ€§ä¿ç•™
          scheduleRetry(error.retryAfter || 5);
          break;
        case 500:
        case 503:
          retryWithBackoff(); // æœåŠ¡å™¨é”™è¯¯é‡è¯•
          break;
        default:
          showGenericError(error.message);
      }
    }
    ```

    <Note>
      **æ³¨æ„**ï¼šå½“å‰ API ä¸ä¼šè¿”å› 429 é”™è¯¯ï¼ˆæœªå®ç°é™æµï¼‰ï¼Œcase 429 ä¸ºæœªæ¥å…¼å®¹æ€§ä¿ç•™ã€‚
    </Note>
  </Accordion>

  <Accordion title="ä½¿ç”¨ validateOnly é¢„æ£€">
    åœ¨æ­£å¼è°ƒç”¨å‰éªŒè¯å‚æ•°:

    ```javascript
    // å…ˆéªŒè¯
    const validateResponse = await fetch(url, {
      ...options,
      body: JSON.stringify({ ...payload, validateOnly: true })
    });

    const validation = await validateResponse.json();

    if (!validation.data.valid) {
      console.error('Validation failed:', validation.data.errors);
      return; // ä¸å‘èµ·å®é™…è¯·æ±‚
    }

    // éªŒè¯é€šè¿‡,å‘èµ·å®é™…è¯·æ±‚
    const response = await fetch(url, options);
    ```
  </Accordion>
</AccordionGroup>

## ä¸‹ä¸€æ­¥

<CardGroup cols={2}>
  <Card
    title="é”™è¯¯å¤„ç†æŒ‡å—"
    icon="shield"
    href="/features/error-handling"
  >
    æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯å¤„ç†ç¤ºä¾‹ä»£ç 
  </Card>

  <Card
    title="è°ƒè¯•æŠ€å·§"
    icon="bug"
    href="/best-practices/debugging"
  >
    å­¦ä¹ é«˜æ•ˆçš„è°ƒè¯•æ–¹æ³•
  </Card>
</CardGroup>
